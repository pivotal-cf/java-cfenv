plugins {
    id 'io.pivotal.cfenv.java-conventions'
    alias libs.plugins.asciidoctorJvmPdf
    alias libs.plugins.asciidoctorJvm
}

description = 'Java CF Env Documentation'

configurations {
    asciidoctorExtensions
}

dependencies {
    asciidoctorExtensions libs.spring.asciidoctor.backends
}

task prepareAsciidocBuild(type: Sync) {
    // Copy doc sources
    from "src/main/asciidoc"
    // to a temporary build directory
    into "$buildDir/asciidoc"
}

asciidoctorPdf {
    dependsOn prepareAsciidocBuild
    baseDirFollowsSourceFile()

    asciidoctorj {
        sourceDir "$buildDir/asciidoc"
        inputs.dir(sourceDir)
        sources {
            include 'index.adoc'
        }
        options doctype: 'book'
        attributes 'icons': 'font',
                'sectanchors': '',
                'sectnums': '',
                'toc': '',
                'source-highlighter' : 'coderay',
                revnumber: project.version,
                'project-version': project.version
    }
}

asciidoctor {
    dependsOn asciidoctorPdf
    baseDirFollowsSourceFile()
    sourceDir "$buildDir/asciidoc"
    sources {
        include '*.adoc'
    }
    resources {
        from(sourceDir) {
            include 'images/*', 'css/**', 'js/**'
        }
    }
    logDocuments = true
    options doctype: 'book', eruby: 'erubis'
    attributes 'revnumber': project.version,
            'spring-version': project.version,
            'branch-or-tag': project.version.endsWith('SNAPSHOT') ? 'main' : "v${project.version}",
            'icons': 'font',
            'idprefix': '',
            'idseparator': '-',
            docinfo: 'shared',
            sectanchors: '',
            sectnums: '',
            stylesdir: "css/",
            stylesheet: 'spring.css',
            'linkcss': true,
            'nofooter': true,
            'allow-uri-read': '',
            'source-highlighter': 'highlight.js',
            'highlightjsdir': 'js/highlight',
            'highlightjs-theme': 'github',
            'project-version': project.version
}
